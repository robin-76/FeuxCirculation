<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Feux de circulation</title>
        <h1>Feux de circulation</h1>
        <link href="index.css" type="text/css" rel="stylesheet" />

        <script type='text/javascript'>
            window.onload = function() {
                var canvas = document.getElementById("canvas");
                var ctx = canvas.getContext("2d"); 

                var nbVoitures = 6;
                var interval;
                var orangeFiniHorizontal = false, orangeFiniVertical = false;
                var bVertHorizontal = false, bRougeHorizontal = false;
                var bVertVertical = false, bRougeVertical = false;
                var distanceArret = 120, distanceMin = 125, distanceMax = 500;
                var vitesseMin = 0.2, vitesseMax = 1.5;

                // positions initiales des voitures selon l'axe
                var yGauche = 382, yDroite = 336;
                var xBas = 390, xHaut = 344;

                var feuGauche = 246, feuDroite = 419;
                var feuBas = 405, feuHaut = 245;

                var tabVoitureStopGauche = new Array(), tabVoitureStopDroite = new Array();
                var tabVoitureStopBas = new Array(), tabVoitureStopHaut = new Array();

                // anciennes positions des voitures
                var tabOldXGauche = new Array(), tabOldXDroite = new Array();
                var tabOldYBas = new Array(), tabOldYHaut = new Array();

                // positions initiales des voitures
                var tabXGauche = new Array(), tabXDroite = new Array();
                var tabYBas = new Array(), tabYHaut = new Array();

                // position des voitures
                var g = -134, d = 800;
                var b = 788, h = -140;
                for(var i=0; i<nbVoitures; i++) {
                    tabXGauche[i] = g;
                    g = g - Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                    tabXDroite[i] = d;
                    d = d + Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                    tabYBas[i] = b;
                    b = b + Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                    tabYHaut[i] = h;
                    h = h - Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                }
               
                var tabImgGauche = new Array(), tabImgDroite = new Array();
                var tabImgBas = new Array(), tabImgHaut = new Array();
                for(var i=0; i<nbVoitures; i++) {
                    tabImgGauche[i] = new Image();
                    tabImgGauche[i].src = "img/gaucheVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                    tabImgDroite[i] = new Image();
                    tabImgDroite[i].src = "img/droiteVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                    tabImgBas[i] = new Image();
                    tabImgBas[i].src = "img/basVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                    tabImgHaut[i] = new Image();
                    tabImgHaut[i].src = "img/hautVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                }

                feuxEteintsHorizontal();
                feuxEteintsVertical();

                function deplacementVoitures() {
                    canvas.width=canvas.width;       

                    for(var i=0; i<nbVoitures; i++) {
                        ctx.drawImage(tabImgGauche[i], tabXGauche[i], yGauche);
                        ctx.drawImage(tabImgDroite[i], tabXDroite[i], yDroite);
                        ctx.drawImage(tabImgBas[i], xBas, tabYBas[i]);
                        ctx.drawImage(tabImgHaut[i], xHaut, tabYHaut[i]);
                        
                        if(tabXGauche[i] == tabOldXGauche[i])
                            tabVoitureStopGauche[i] = true;
                        else
                            tabVoitureStopGauche[i] = false;
                        
                        if(tabXDroite[i] == tabOldXDroite[i])
                            tabVoitureStopDroite[i] = true;
                        else
                            tabVoitureStopDroite[i] = false;

                        if(tabYBas[i] == tabOldYBas[i])
                            tabVoitureStopBas[i] = true;
                        else
                            tabVoitureStopBas[i] = false;
                            
                        if(tabYHaut[i] == tabOldYHaut[i])
                            tabVoitureStopHaut[i] = true;
                        else
                            tabVoitureStopHaut[i] = false;    
                        
                        tabOldXGauche[i] = tabXGauche[i];
                        tabOldXDroite[i] = tabXDroite[i];
                        tabOldYBas[i] = tabYBas[i];
                        tabOldYHaut[i] = tabYHaut[i];
                    }                       
                        
                    if(bVertHorizontal) {
                        vertHorizontal();
                        tabXGauche[0] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        tabXDroite[0] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        for(var i=0; i<nbVoitures; i++) {
                            if(tabXGauche[i+1]<tabXGauche[i]-distanceMin)
                                tabXGauche[i+1] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                            if(tabXDroite[i+1]>tabXDroite[i]+distanceMin)
                                tabXDroite[i+1] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;  
                        }                            
                    }
                    
                    else if(bRougeHorizontal) {
                        for(var i=0; i<nbVoitures-1; i++) {
                            if(tabXGauche[i]-tabXGauche[i+1] < distanceArret)
                                tabVoitureStopGauche[i+1] = true;
                            else 
                                tabVoitureStopGauche[i+1] = false;
                            
                            if(tabXDroite[i+1]-tabXDroite[i] < distanceArret)
                                tabVoitureStopDroite[i+1] = true;
                            else 
                                tabVoitureStopDroite[i+1] = false;
                        }

                        for(var i=0; i<nbVoitures; i++) {
                            if((parseInt(tabXGauche[i])!=feuGauche && parseInt(tabXGauche[i])!=feuGauche-1 && parseInt(tabXGauche[i])!=feuGauche+1) && !tabVoitureStopGauche[i])
                                tabXGauche[i] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;

                            if((parseInt(tabXDroite[i])!=feuDroite && parseInt(tabXDroite[i])!=feuDroite-1 && parseInt(tabXDroite[i])!=feuDroite+1) && !tabVoitureStopDroite[i])
                                tabXDroite[i] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        }
                               
                        if(!orangeFiniHorizontal) {
                            orangeHorizontal();
                            setTimeout(rougeHorizontal, 600);
                        }
                        else 
                            rougeHorizontal();
                    }

                    else
                        feuxEteintsHorizontal();

                    if(bVertVertical) {
                        vertVertical();
                        tabYBas[0] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        tabYHaut[0] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        for(var i=0; i<nbVoitures; i++) {
                            if(tabYBas[i+1]>tabYBas[i]+distanceMin)
                                tabYBas[i+1] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                            if(tabYHaut[i+1]<tabYHaut[i]-distanceMin)
                                tabYHaut[i+1] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;  
                        }                            
                    }

                    else if(bRougeVertical) { 
                        for(var i=0; i<nbVoitures-1; i++) {
                            if(tabYBas[i+1]-tabYBas[i] < distanceArret)
                                tabVoitureStopBas[i+1] = true;
                            else 
                                tabVoitureStopBas[i+1] = false;

                            if(tabYHaut[i]-tabYHaut[i+1] < distanceArret)
                                tabVoitureStopHaut[i+1] = true;
                            else 
                                tabVoitureStopHaut[i+1] = false;
                        }

                        for(var i=0; i<nbVoitures; i++) {
                            if((parseInt(tabYBas[i])!=feuBas && parseInt(tabYBas[i])!=feuBas-1 && parseInt(tabYBas[i])!=feuBas+1) && !tabVoitureStopBas[i])
                                tabYBas[i] -= Math.random() * (vitesseMax - vitesseMin) + vitesseMin;

                            if((parseInt(tabYHaut[i])!=feuHaut && parseInt(tabYHaut[i])!=feuHaut-1 && parseInt(tabYHaut[i])!=feuHaut+1) && !tabVoitureStopHaut[i])
                                tabYHaut[i] += Math.random() * (vitesseMax - vitesseMin) + vitesseMin;
                        }
                               
                        if(!orangeFiniVertical) {
                            orangeVertical();
                            setTimeout(rougeVertical, 600);
                        }
                        else 
                            rougeVertical();
                    }

                    else
                        feuxEteintsVertical();

                    // On recommence lorsque la derniÃ¨re voiture a finit
                    if(parseInt(tabXGauche[nbVoitures-1])>800) {
                        var g = -134;
                        for(var i=0; i<nbVoitures; i++) {
                            tabXGauche[i] = g;
                            g = g - Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                            tabImgGauche[i] = new Image();
                            tabImgGauche[i].src = "img/gaucheVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                        }
                    }

                    if(parseInt(tabXDroite[nbVoitures-1])<-134) {
                        var d = 800;
                        for(var i=0; i<nbVoitures; i++) {
                            tabXDroite[i] = d;
                            d = d + Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                            tabImgDroite[i] = new Image();
                            tabImgDroite[i].src = "img/droiteVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                        }
                    }

                    if(parseInt(tabYBas[nbVoitures-1])<-140) {
                        var b = 788;
                        for(var i=0; i<nbVoitures; i++) {
                            tabYBas[i] = b;
                            b = b + Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                            tabImgBas[i] = new Image();
                            tabImgBas[i].src = "img/basVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                        }
                    }

                    if(parseInt(tabYHaut[nbVoitures-1])>788) {
                        var h = -140;
                        for(var i=0; i<nbVoitures; i++) {
                            tabYHaut[i] = h;
                            h = h - Math.floor(Math.random() * (distanceMax+1 - distanceMin) + distanceMin);
                            tabImgHaut[i] = new Image();
                            tabImgHaut[i].src = "img/hautVoiture" + Math.floor((Math.random() * nbVoitures)) + ".png";
                        }
                    }
                }

                function feuxEteintsHorizontal() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(286, 495.2, 9, 0, 2 * Math.PI);
                    ctx.arc(305.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.arc(324.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(495, 307.3, 9, 0, 2 * Math.PI);
                    ctx.arc(514, 307.3, 9, 0, 2 * Math.PI);
                    ctx.arc(533, 307.3, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function feuxEteintsVertical() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(505.3, 484, 9, 0, 2 * Math.PI);
                    ctx.arc(505.3, 504, 9, 0, 2 * Math.PI);
                    ctx.arc(505.3, 524, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(314, 279, 9, 0, 2 * Math.PI);
                    ctx.arc(314, 299, 9, 0, 2 * Math.PI);
                    ctx.arc(314, 319, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function vertHorizontal() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(305.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.arc(324.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(495, 307.3, 9, 0, 2 * Math.PI);
                    ctx.arc(514, 307.3, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function orangeHorizontal() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(286, 495.2, 9, 0, 2 * Math.PI);
                    ctx.arc(324.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(495, 307.3, 9, 0, 2 * Math.PI);
                    ctx.arc(533, 307.3, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function rougeHorizontal() {
                    orangeFiniHorizontal = true;

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(286, 495.2, 9, 0, 2 * Math.PI);
                    ctx.arc(305.5, 495.2, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(514, 307.3, 9, 0, 2 * Math.PI);
                    ctx.arc(533, 307.3, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function vertVertical() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(505.3, 484, 9, 0, 2 * Math.PI);
                    ctx.arc(505.3, 504, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(314, 299, 9, 0, 2 * Math.PI);
                    ctx.arc(314, 319, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function orangeVertical() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(505.3, 484, 9, 0, 2 * Math.PI);
                    ctx.arc(505.3, 524, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(314, 279, 9, 0, 2 * Math.PI);
                    ctx.arc(314, 319, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function rougeVertical() {
                    orangeFiniVertical = true;

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(505.3, 504, 9, 0, 2 * Math.PI);
                    ctx.arc(505.3, 524, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(314, 279, 9, 0, 2 * Math.PI);
                    ctx.arc(314, 299, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }
                
                function boutonVertHorizontal() {
                    clearInterval(interval);
                    interval = setInterval(deplacementVoitures, 6);
                    orangeFiniHorizontal = false;
                    bVertHorizontal = true;
                    bRougeHorizontal = false;

                    document.getElementById("boutonVertHorizontal").disabled = true;
                    document.getElementById("boutonRougeHorizontal").disabled = false;
                }
                
                function boutonRougeHorizontal() {
                    orangeFiniHorizontal = false;
                    bRougeHorizontal = true;
                    bVertHorizontal = false;

                    document.getElementById("boutonRougeHorizontal").disabled = true;
                    setTimeout(function(){
                        document.getElementById("boutonVertHorizontal").disabled = false;
                    }, 600);    
                }

                function boutonVertVertical() {
                    clearInterval(interval);
                    interval = setInterval(deplacementVoitures, 6);
                    orangeFiniVertical = false;
                    bVertVertical = true;
                    bRougeVertical = false;

                    document.getElementById("boutonVertVertical").disabled = true;
                    document.getElementById("boutonRougeVertical").disabled = false;
                }
                
                function boutonRougeVertical() {
                    orangeFiniVertical = false;
                    bRougeVertical = true;
                    bVertVertical = false;

                    document.getElementById("boutonRougeVertical").disabled = true;
                    setTimeout(function(){
                        document.getElementById("boutonVertVertical").disabled = false;
                    }, 600);    
                }

                document.getElementById('boutonVertHorizontal').onclick = function(evt) { boutonVertHorizontal(); }
                document.getElementById("boutonRougeHorizontal").disabled = true;
                document.getElementById('boutonRougeHorizontal').onclick = function(evt) { boutonRougeHorizontal(); }

                document.getElementById('boutonVertVertical').onclick = function(evt) { boutonVertVertical(); }
                document.getElementById("boutonRougeVertical").disabled = true;
                document.getElementById('boutonRougeVertical').onclick = function(evt) { boutonRougeVertical(); }
            }
            
        </script>
    </head>

    <body>
        <canvas id="canvas" width="800" height="800"></canvas>
        <div class='boutonsGauche'>
            <div class='title'>Route horizontale</div>
            <div class='listOfButtons'>
                <button class="boutonRouge" id="boutonRougeHorizontal" type="button">Rouge</button>
                <button class="boutonVert" id="boutonVertHorizontal" type="button">Vert</button>
            </div>
          </div>
        <div class='boutonsDroite'>
            <div class='title'>Route verticale</div>
            <div class='listOfButtons'>
                <button class="boutonRouge" id="boutonRougeVertical" type="button">Rouge</button>
                <button class="boutonVert" id="boutonVertVertical" type="button">Vert</button>
            </div>
          </div>  
    </body>
</html>
