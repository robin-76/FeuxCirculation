<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Projet Arduino</title>
        <h1>Projet Arduino</h1>
        <link href="index.css" type="text/css" rel="stylesheet" />

        <script type='text/javascript'>
            window.onload=function() {
                var canvas = document.getElementById("canvas");
                var ctx = canvas.getContext("2d");

            /*    // Afficher x et y avec la souris
                canvas.addEventListener("mousemove", function(e) { 
                var cRect = canvas.getBoundingClientRect();        
                var canvasX = Math.round(e.clientX - cRect.left);  
                var canvasY = Math.round(e.clientY - cRect.top);   
                ctx.clearRect(0, 0, canvas.width, canvas.height);  
                ctx.fillText("X: "+canvasX+", Y: "+canvasY, 10, 20);
                });

                ctx.rect(155, 262, 100, 50);
                ctx.fill();*/

                // Feux éteints à l'état initial
                ctx.beginPath();
                ctx.fillStyle="#000000"
                ctx.arc(839, 475.4, 9, 0, 2 * Math.PI);
                ctx.arc(858, 475.4, 9, 0, 2 * Math.PI);
                ctx.arc(877, 475.4, 9, 0, 2 * Math.PI);
                ctx.fill();

                ctx.beginPath();
                ctx.fillStyle="#000000"
                ctx.arc(1047, 287.5, 9, 0, 2 * Math.PI);
                ctx.arc(1066, 287.5, 9, 0, 2 * Math.PI);
                ctx.arc(1086, 287.5, 9, 0, 2 * Math.PI);
                ctx.fill();
                
                var timer = setInterval(deplacementVoiture, 5);
                var timeoutID;
                var orangeFini = false;
                var bVert = false, bRouge = false;
                var voiture1stop = true;
                var voiture2stop = true;
                var oldX = 0;
                var oldX2 = 0;

                var x = 518, y = 363; // position initiale voiture
                var img = new Image();
                img.src = "voitureRouge.png";

                var x2 = 618, y2 = 363; // position initiale voiture
                var img2 = new Image();
                img2.src = "voitureRouge.png";

                function vert() {
                    orangeFini = true;

                    ctx.clearRect(800, 450, 100, 50);
                    ctx.clearRect(1025, 262, 100, 50);

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(858, 475.4, 9, 0, 2 * Math.PI);
                    ctx.arc(877, 475.4, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(1047, 287.5, 9, 0, 2 * Math.PI);
                    ctx.arc(1066, 287.5, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function orange() {
                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(839, 475.4, 9, 0, 2 * Math.PI);
                    ctx.arc(877, 475.4, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(1047, 287.5, 9, 0, 2 * Math.PI);
                    ctx.arc(1086, 287.5, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function rouge() {
                    orangeFini = true;

                    ctx.clearRect(800, 450, 100, 50);
                    ctx.clearRect(1025, 262, 100, 50);

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(839, 475.4, 9, 0, 2 * Math.PI);
                    ctx.arc(858, 475.4, 9, 0, 2 * Math.PI);
                    ctx.fill();

                    ctx.beginPath();
                    ctx.fillStyle="#000000"
                    ctx.arc(1066, 287.5, 9, 0, 2 * Math.PI);
                    ctx.arc(1086, 287.5, 9, 0, 2 * Math.PI);
                    ctx.fill();
                }

                function deplacementVoiture() {
                    canvas.width=canvas.width;
                    ctx.drawImage(img, x, y);
                    ctx.drawImage(img, x2, y2);

                    if(oldX == x )
                        voiture1stop = true;
                    else
                        voiture1stop = false;    

                    if(x2 == oldX2)
                        voiture2stop = true;
                    else
                        voiture2stop = false;    

                    if(x2-x < 100)
                        voiture1stop = true;

                    oldX = x;
                    oldX2 = x2;
                        
                    if(bVert) {
                        if(!orangeFini) {
                            if(!voiture2stop) x2 += 0.5;
                        orange();
                        timeoutID = setTimeout(vert, 600);
                        }
                        else {
                            vert();
                            x += 0.5; // Avancement de la voiture
                            x2 += 0.5;
                        }
                    }
                    
                    if(bRouge) { 
                        if(x!=800 && !voiture1stop) x += 0.5; // Avancement de la voiture
                        if(x2!=800 && !voiture2stop)  x2 += 0.5;
                        if(!orangeFini) {
                        orange();
                        timeoutID = setTimeout(rouge, 600);
                        }
                        else rouge();
                    }
                }

                document.getElementById('feuVert').onclick = function(evt) { feuVert(); }
                
                document.getElementById("feuRouge").disabled = true;
                document.getElementById('feuRouge').onclick = function(evt) { feuRouge(); }
                
                function feuVert() {
                    orangeFini = false;
                    bVert = true;
                    bRouge = false;
                  //  clearTimeout(timeoutID); ne fonctionne pas
                  voiture1stop = false;
                  voiture2stop = false;

                    document.getElementById("feuVert").disabled = true;
                    document.getElementById("feuRouge").disabled = false;
                   
                    
                }
                
                function feuRouge() {
                    orangeFini = false;
                    bRouge = true;
                    bVert = false;
                  //  clearTimeout(timeoutID); ne fontionne pas

                    document.getElementById("feuRouge").disabled = true;
                    document.getElementById("feuVert").disabled = false;
                }
            }
            
        </script>
    </head>

    <body>
        <canvas id="canvas" width="1352" height="800" ></canvas>
        <input type="button" id="feuVert" name="feuVert" value="Feu vert">
        <input type="button" id="feuRouge" name="feuRouge" value="Feu rouge">
    </body>
</html>
